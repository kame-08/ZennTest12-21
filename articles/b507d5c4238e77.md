---
title: "Event"
emoji: "ğŸˆ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [swift]
published: false
---

# EventKitã¨ã¯
https://developer.apple.com/documentation/eventkit
ä¸€ã¤
SwiftUIã§ã¯ã€EventKitãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€Appleç´”æ­£ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ»ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ãƒ»å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
[EventKit UI](https://developer.apple.com/documentation/eventkitui)ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã‚¤ãƒ™ãƒ³ãƒˆã®è¡¨ç¤ºãƒ»ä½œæˆãªã©ã®ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ç°¡å˜ã«ã‚¢ãƒ—ãƒªã«çµ„ã¿è¾¼ã‚€ã“ã¨ã‚‚ã§ãã¾ã™ã€‚(ã“ã®è¨˜äº‹ã§ã¯ç´¹ä»‹ã—ãªã„ã§ã™ã€‚)
ä»Šå›ã¯ã€EventKitã‚’ä½¿ç”¨ã—ã¦ã€ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®ã‚¿ã‚¹ã‚¯ã®å–å¾—ãƒ»ä½œæˆãƒ»å¤‰æ›´ãƒ»å‰Šé™¤ã‚’è¡Œã„ã¾ã™ã€‚
ï¼‘ã¤ 

## ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç·¨ã¯ã“ã¡ã‚‰ã®è¨˜äº‹ã§ç´¹ä»‹ã—ã¦ã„ã¾ã™ã€‚
https://zenn.dev/ryo_dev/articles/afc9b7686e08c5

# ä»Šå›ä½œæˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
ä»Šå›ä½œæˆã™ã‚‹ã‚¢ãƒ—ãƒªã§ã¯ã€
ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’æ“ä½œ(ã‚¿ã‚¹ã‚¯ã®å–å¾—ãƒ»ä½œæˆãƒ»å¤‰æ›´ãƒ»å‰Šé™¤)ã™ã‚‹ReminderManager.swiftã¨ã€
å–å¾—ã—ãŸã‚¤ãƒ™ãƒ³ãƒˆã‚’è¡¨ç¤ºã™ã‚‹ContentView.swiftã¨ã€
ã‚¤ãƒ™ãƒ³ãƒˆã®è¿½åŠ ãƒ»å¤‰æ›´ã‚’ã™ã‚‹CreateEventView.swiftã‚’ä½œæˆã—ã¾ã™ã€‚

```mermaid
graph TB
    A(ReminderManager.swift)ã€€--> B --> A
    B(ContentView.swift) --> C
    C(CreateEventView.swift) --> A
```

# ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ‰‹é †
## 1. Info.plisã«Keyã¨Valueã®è¿½åŠ 
https://developer.apple.com/documentation/bundleresources/information_property_list/nsremindersusagedescription

Key
```swift
Privacy - Reminders Usage Description
```
Valueã«ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªåˆ©ç”¨ç”¨é€”ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚
```swift
ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¯ã€ã‚¿ã‚¹ã‚¯ã®è¡¨ç¤ºã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
```

## 2. ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’æ“ä½œã™ã‚‹Classã‚’ä½œæˆ
```swift:ReminderManager.swift
import Foundation

class ReminderManager: ObservableObject {
    
}
```

## 3. EventKitã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
```swift:ReminderManager.swift
import EventKit
```

## 4. ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¦æ±‚
```swift:ReminderManager.swift
var store = EKEventStore()
// ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®èªè¨¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
@Published var statusMessage = ""

init() {
    Task {
        do {
            // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¦æ±‚
            try await store.requestAccess(to: .reminder)
        } catch {
            print(error.localizedDescription)
        }
        // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®èªè¨¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
        let status = EKEventStore.authorizationStatus(for: .reminder)
        
        switch status {
        case .notDetermined:
            statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹\næ¨©é™ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚"
        case .restricted:
            statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹\næ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚"
        case .denied:
            statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒ\næ˜ç¤ºçš„ã«æ‹’å¦ã•ã‚Œã¦ã„ã¾ã™ã€‚"
        case .authorized:
            statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒ\nè¨±å¯ã•ã‚Œã¦ã„ã¾ã™ã€‚"
        @unknown default:
            statusMessage = "@unknown default"
        }
    }
}
```

## 5. ContentViewã§ReminderManagerã‚’ä½¿ç”¨ã™ã‚‹
ä»Šå›ã¯ã€ä¸€ã¤ã®ReminderManagerã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¤‡æ•°ã®Viewã§ä½¿ç”¨ã—ãŸã„ãŸã‚ã€@EnvironmentObjectã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

ContentViewã‚’å¤‰æ›´ã—ã¾ã™ã€‚
```swift:ContentView.swift
struct ContentView: View {
    @EnvironmentObject var reminderManager: ReminderManager
    
    var body: some View {
        VStack {
            Text(reminderManager.statusMessage)
        }
    }
}
```

```diff swift:EventKit_ReminderApp.swift
 @main
 struct EventKit_ReminderApp: App {
     var body: some Scene {
         WindowGroup {
             ContentView()
+                .environmentObject(ReminderManager())
         }
     }
 }
```

## 6. å®ŒæˆğŸ‰
![](https://storage.googleapis.com/zenn-user-upload/c2546b3feb10-20221217.png)

:::details ã“ã“ã¾ã§ã®ã‚³ãƒ¼ãƒ‰
```swift:ContentView.swift
import SwiftUI

struct ContentView: View {
    @EnvironmentObject var reminderManager: ReminderManager
    
    var body: some View {
        VStack {
            Text(reminderManager.statusMessage)
        }
    }
}
```

```swift:ReminderManager.swift
import Foundation
import EventKit

class ReminderManager: ObservableObject {
    var store = EKEventStore()
    // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®èªè¨¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    @Published var statusMessage = ""
    
    init() {
        Task {
            do {
                // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¦æ±‚
                try await store.requestAccess(to: .reminder)
            } catch {
                print(error.localizedDescription)
            }
            // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®èªè¨¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
            let status = EKEventStore.authorizationStatus(for: .reminder)
            
            switch status {
            case .notDetermined:
                statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹\næ¨©é™ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚"
            case .restricted:
                statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹\næ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚"
            case .denied:
                statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒ\næ˜ç¤ºçš„ã«æ‹’å¦ã•ã‚Œã¦ã„ã¾ã™ã€‚"
            case .authorized:
                statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒ\nè¨±å¯ã•ã‚Œã¦ã„ã¾ã™ã€‚"
            @unknown default:
                statusMessage = "@unknown default"
            }
        }
    }
}
```

```swift:EventKit_ReminderApp.swift
import SwiftUI

@main
struct EventKit_ReminderApp: App {
    var body: some Scene {
        WindowGroup {
            ContentView()
                .environmentObject(ReminderManager())
        }
    }
}
```
:::

# ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹æ‰‹é †
## 1. ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’å–å¾—ã™ã‚‹é–¢æ•°ã‚’ä½œæˆ
https://developer.apple.com/documentation/eventkit/retrieving_events_and_reminders

å—ã‘å–ã£ãŸæ—¥ä»˜ã‹ã‚‰ã€æœŸé–“å†…ã®æœªå®Œäº†ã®ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’å–å¾—ã—ã¦ã€é…åˆ—ã«è¿½åŠ ã™ã‚‹é–¢æ•°ã‚’ä½œæˆã—ã¾ã™ã€‚
:::message alert
predicateForIncompleteRemindersãƒ¡ã‚½ãƒƒãƒ‰ã§æŒ‡å®šã™ã‚‹æœŸé–“ã¯ã€
withDueDateStarting < å–å¾—ã™ã‚‹ç¯„å›² â‰¦ ending
ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚[^1]
ä»Šå›ã®ä¾‹ã§ã¯ã€å‰æ—¥ã®23:59:59 ~ 23:59:0ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€
0:00 ~ 23:59ã¾ã§ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚
ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯ç§’æ•°ã®ãƒ‡ãƒ¼ã‚¿ã¯æŒã£ã¦ã„ãªã„ãŸã‚ã€
withDueDateStartingã¯å–å¾—ã—ãŸã„ç¯„å›²-1ç§’ã™ã‚‹ã“ã¨ã§æœŸå¾…é€šã‚Šã®å‹•ãã‚’ã—ã¾ã™ã€‚
[^1]: 2022å¹´12æœˆ16æ—¥ç¾åœ¨
Xcode14.2ãŠã‚ˆã³iOS16.2ã§æ¤œè¨¼
:::

```swift:ReminderManager.swift
// å–å¾—ã•ã‚ŒãŸãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
@Published var reminders: [EKReminder]? = nil
// å–å¾—ã—ãŸã„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜
@Published var day = Date()

/// ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®å–å¾—
func fetchReminder() {
    // é–‹å§‹æ—¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
    // æŒ‡å®šã—ãŸå‰ã®æ—¥ä»˜ã®23:59:59
    let start = Calendar.current.date(byAdding: .second, value: -1, to: Calendar.current.startOfDay(for: day))
    // çµ‚äº†æ—¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
    // æŒ‡å®šã—ãŸæ—¥ä»˜ã®23:59:0
    let end = Calendar.current.date(bySettingHour: 23, minute: 59, second: 0, of: Calendar.current.startOfDay(for: day))
    // ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆã‚¢ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰è¿°èªã‚’ä½œæˆ
    var predicate: NSPredicate? = nil
    predicate = store.predicateForIncompleteReminders(withDueDateStarting: start, ending: end, calendars: nil)
    // è¿°èªã«ä¸€è‡´ã™ã‚‹å…¨ã¦ã®ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’å–å¾—
    if let predicate {
        store.fetchReminders(matching: predicate) { reminder in
            self.reminders = reminder
        }
    }
}
```
### predicateForIncompleteReminders(withDueDateStarting:ending:calendars:)
https://developer.apple.com/documentation/eventkit/ekeventstore/1507143-predicateforincompletereminders

- withDueDateStarting
	æŒ‡å®šã—ãŸæ—¥æ™‚ã‚’å«ã¾ãªã„ã€å–å¾—ã™ã‚‹ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®å§‹ã¾ã‚Šã®ç¯„å›²
withDueDateStartingã«æ—¥ä»˜ã‚’æŒ‡å®šã—ã¦endingã«nilã‚’æŒ‡å®šã—ãŸå ´åˆã¯endingã‚ˆã‚Šå‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—ã™ã‚‹ã€‚(ãã®éš›ã€æ—¥æ™‚ã®æŒ‡å®šã‚’ã—ã¦ã„ãªã„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¯å–å¾—ã•ã‚Œãªã„)
- ending
	æŒ‡å®šã—ãŸæ—¥æ™‚ã‚’å«ã‚€ã€å–å¾—ã™ã‚‹ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®çµ‚ã‚ã‚Šã®ç¯„å›²
withDueDateStartingã«æ—¥ä»˜ã‚’æŒ‡å®šã—ã¦endingã«nilã‚’æŒ‡å®šã—ãŸå ´åˆã¯withDueDateStartingã‚ˆã‚Šå¾Œã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—ã™ã‚‹ã€‚(ãã®éš›ã€æ—¥æ™‚ã®æŒ‡å®šã‚’ã—ã¦ã„ãªã„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¯å–å¾—ã•ã‚Œãªã„)
- calendars
	ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’å–å¾—ã™ã‚‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æŒ‡å®š
å…¨ã¦ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’å–å¾—ã—ãŸã„å ´åˆã¯ã€nilã«ã™ã‚‹ã€‚

## 2. fetchEvent()ã‚’å‘¼ã³å‡ºã™
ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒè¨±å¯ã•ã‚Œã¦ã„ãŸå ´åˆã¯ã€å…ˆã»ã©ä½œæˆã—ãŸfetchEvent()ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

```diff swift:ReminderManager.swift
 init() {
     Task {
         do {
             // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¦æ±‚
             try await store.requestAccess(to: .reminder)
         } catch {
             print(error.localizedDescription)
         }
         // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®èªè¨¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
         let status = EKEventStore.authorizationStatus(for: .reminder)
         
         switch status {
         case .notDetermined:
             statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹\næ¨©é™ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚"
         case .restricted:
             statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹\næ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚"
         case .denied:
             statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒ\næ˜ç¤ºçš„ã«æ‹’å¦ã•ã‚Œã¦ã„ã¾ã™ã€‚"
         case .authorized:
             statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒ\nè¨±å¯ã•ã‚Œã¦ã„ã¾ã™ã€‚"
+            fetchReminder()
         @unknown default:
             statusMessage = "@unknown default"
         }
     }
 }
```

## 3. ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¡¨ç¤º
ContentViewã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚
ReminderManagerã®é…åˆ—ã«ã‚¤ãƒ™ãƒ³ãƒˆãŒå…¥ã£ã¦ã„ã‚‹å ´åˆã¯ã€ã‚¤ãƒ™ãƒ³ãƒˆã®ä¸€è¦§ã‚’è¡¨ç¤ºã€
ReminderManagerã®é…åˆ—ã«ã‚¤ãƒ™ãƒ³ãƒˆãŒå…¥ã£ã¦ã„ãªã„å ´åˆã¯ã€èªè¨¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```diff swift:ContentView.swift
struct ContentView: View {
    @EnvironmentObject var reminderManager: ReminderManager
    
    var body: some View {
        if let aReminder = reminderManager.reminders {
            NavigationStack {
                List(aReminder, id: \.calendarItemIdentifier) { reminder in
                    HStack {
                        Image(systemName: reminder.isCompleted ? "checkmark.circle.fill" : "circle")
                            .foregroundColor(reminder.isCompleted ? Color.accentColor : Color.gray)
                        Text(reminder.title)
                    }
                }
                .toolbar {
                    ToolbarItem(placement: .principal) {
                        DatePicker("", selection: $reminderManager.day, displayedComponents: .date)
                            .labelsHidden()
                            .onChange(of: reminderManager.day) { newValue in
                                reminderManager.fetchReminder()
                            }
                    }
                }
            }
        } else {
            Text(reminderManager.statusMessage)
        }
    }
}
```

## 4. ã‚¤ãƒ™ãƒ³ãƒˆãŒå¤‰æ›´ã•ã‚ŒãŸã‚‰å†æç”»ã™ã‚‹
https://developer.apple.com/documentation/eventkit/updating_with_notifications
EventKitã§ç”¨æ„ã•ã‚Œã¦ã„ã‚‹Notificationã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã€
ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å¤‰æ›´ã‚’å—ã‘å–ã‚Šã€æŒ‡å®šã—ãŸé–¢æ•°ã‚’å®Ÿè¡Œã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ä»Šå›ã¯ã€å¤‰æ›´ã‚’å—ã‘å–ã£ãŸã‚‰fetchReminder()ã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```diff swift:ReminderManager.swift
 /// ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®å–å¾—
-func fetchReminder() {
+@objc func fetchReminder() {
     // é–‹å§‹æ—¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
     // æŒ‡å®šã—ãŸå‰ã®æ—¥ä»˜ã®23:59:59
     let start = Calendar.current.date(byAdding: .second, value: -1, to: Calendar.current.startOfDay(for: day))
     // çµ‚äº†æ—¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
     // æŒ‡å®šã—ãŸæ—¥ä»˜ã®23:59:0
     let end = Calendar.current.date(bySettingHour: 23, minute: 59, second: 0, of: Calendar.current.startOfDay(for: day))
     // ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆã‚¢ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰è¿°èªã‚’ä½œæˆ
     var predicate: NSPredicate? = nil
     predicate = store.predicateForIncompleteReminders(withDueDateStarting: start, ending: end, calendars: nil)
     // è¿°èªã«ä¸€è‡´ã™ã‚‹å…¨ã¦ã®ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’å–å¾—
     if let predicate {
         store.fetchReminders(matching: predicate) { reminder in
             self.reminders = reminder
         }
     }
 }
```

```diff swift:ReminderManager.swift
 switch status {
 case .notDetermined:
     statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹\næ¨©é™ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚"
 case .restricted:
     statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹\næ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚"
 case .denied:
     statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒ\næ˜ç¤ºçš„ã«æ‹’å¦ã•ã‚Œã¦ã„ã¾ã™ã€‚"
 case .authorized:
     statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒ\nè¨±å¯ã•ã‚Œã¦ã„ã¾ã™ã€‚"
     fetchReminder()
+    // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å¤‰æ›´ã‚’æ¤œå‡ºã—ãŸã‚‰fetchReminder()ã‚’å®Ÿè¡Œã™ã‚‹
+    NotificationCenter.default.addObserver(self, selector: #selector(fetchReminder), name: .EKEventStoreChanged, object: store)
 @unknown default:
     statusMessage = "@unknown default"
 }
```

## 5. å®ŒæˆğŸ‰
![](https://storage.googleapis.com/zenn-user-upload/c931e3543e96-20221217.png)

:::details ã“ã“ã¾ã§ã®ã‚³ãƒ¼ãƒ‰
```swift:ContentView.swift
import SwiftUI

struct ContentView: View {
    @EnvironmentObject var reminderManager: ReminderManager
    
    var body: some View {
        if let aReminder = reminderManager.reminders {
            NavigationStack {
                List(aReminder, id: \.calendarItemIdentifier) { reminder in
                    HStack {
                        Image(systemName: reminder.isCompleted ? "checkmark.circle.fill" : "circle")
                            .foregroundColor(reminder.isCompleted ? Color.accentColor : Color.gray)
                        Text(reminder.title)
                    }
                }
                .toolbar {
                    ToolbarItem(placement: .principal) {
                        DatePicker("", selection: $reminderManager.day, displayedComponents: .date)
                            .labelsHidden()
                            .onChange(of: reminderManager.day) { newValue in
                                reminderManager.fetchReminder()
                            }
                    }
                }
            }
        } else {
            Text(reminderManager.statusMessage)
        }
    }
}
```

```swift:ReminderManager.swift
import Foundation
import EventKit

class ReminderManager: ObservableObject {
    var store = EKEventStore()
    // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®èªè¨¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    @Published var statusMessage = ""
    // å–å¾—ã•ã‚ŒãŸãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
    @Published var reminders: [EKReminder]? = nil
    // å–å¾—ã—ãŸã„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜
    @Published var day = Date()
    
    init() {
        Task {
            do {
                // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¦æ±‚
                try await store.requestAccess(to: .reminder)
            } catch {
                print(error.localizedDescription)
            }
            // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®èªè¨¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
            let status = EKEventStore.authorizationStatus(for: .reminder)
            
            switch status {
            case .notDetermined:
                statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹\næ¨©é™ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚"
            case .restricted:
                statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹\næ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚"
            case .denied:
                statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒ\næ˜ç¤ºçš„ã«æ‹’å¦ã•ã‚Œã¦ã„ã¾ã™ã€‚"
            case .authorized:
                statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒ\nè¨±å¯ã•ã‚Œã¦ã„ã¾ã™ã€‚"
                fetchReminder()
                // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å¤‰æ›´ã‚’æ¤œå‡ºã—ãŸã‚‰fetchReminder()ã‚’å®Ÿè¡Œã™ã‚‹
                NotificationCenter.default.addObserver(self, selector: #selector(fetchReminder), name: .EKEventStoreChanged, object: store)
            @unknown default:
                statusMessage = "@unknown default"
            }
        }
    }
    
    /// ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®å–å¾—
    @objc func fetchReminder() {
        // é–‹å§‹æ—¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
        // æŒ‡å®šã—ãŸå‰ã®æ—¥ä»˜ã®23:59:59
        let start = Calendar.current.date(byAdding: .second, value: -1, to: Calendar.current.startOfDay(for: day))
        // çµ‚äº†æ—¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
        // æŒ‡å®šã—ãŸæ—¥ä»˜ã®23:59:0
        let end = Calendar.current.date(bySettingHour: 23, minute: 59, second: 0, of: Calendar.current.startOfDay(for: day))
        // ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆã‚¢ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰è¿°èªã‚’ä½œæˆ
        var predicate: NSPredicate? = nil
        predicate = store.predicateForIncompleteReminders(withDueDateStarting: start, ending: end, calendars: nil)
        // è¿°èªã«ä¸€è‡´ã™ã‚‹å…¨ã¦ã®ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’å–å¾—
        if let predicate {
            store.fetchReminders(matching: predicate) { reminder in
                self.reminders = reminder
            }
        }
    }
}
```

```swift:EventKit_ReminderApp.swift
import SwiftUI

@main
struct EventKit_ReminderApp: App {
    var body: some Scene {
        WindowGroup {
            ContentView()
                .environmentObject(ReminderManager())
        }
    }
}
```
:::

# ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’è¿½åŠ ã™ã‚‹æ‰‹é †
## 1. ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’è¿½åŠ ã™ã‚‹é–¢æ•°ã‚’ä½œæˆ
https://developer.apple.com/documentation/eventkit/creating_events_and_reminders

å—ã‘å–ã£ãŸã‚¿ã‚¤ãƒˆãƒ«ã¨æ—¥æ™‚ã‹ã‚‰ã€ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’è¿½åŠ ã™ã‚‹é–¢æ•°ã‚’ä½œæˆã—ã¾ã™ã€‚

```swift:ReminderManager.swift
/// ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®è¿½åŠ 
func createReminder(title: String, dueDate: Date){
    // æ–°è¦ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®ä½œæˆ
    let reminder = EKReminder(eventStore: store)
    reminder.title = title
    reminder.dueDateComponents = Calendar.current.dateComponents([.calendar, .year, .month, .day, .hour, .minute], from: dueDate)
    // ä¿å­˜ã™ã‚‹ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
    reminder.calendar = store.defaultCalendarForNewReminders()
    do {
        try store.save(reminder, commit: true)
    } catch {
        print(error.localizedDescription)
    }
}
```

## 2. ã‚¤ãƒ™ãƒ³ãƒˆã®è¿½åŠ ã‚’ã™ã‚‹Viewã‚’ä½œæˆ
```swift:CreateReminderView.swift
struct CreateReminderView: View {
    @EnvironmentObject var reminderManager: ReminderManager
    // ContentViewã®sheetã®ãƒ•ãƒ©ã‚°
    @Environment(\.dismiss) var dismiss
    // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®ã‚¿ã‚¤ãƒˆãƒ«
    @State var title = ""
    // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®é–‹å§‹æ—¥æ™‚
    @State var dueDate = Date()
    
    var body: some View {
        NavigationStack{
            List {
                TextField("ã‚¿ã‚¤ãƒˆãƒ«", text: $title)
                DatePicker("é–‹å§‹", selection: $dueDate)
            }
            .toolbar {
                ToolbarItem(placement: .navigationBarTrailing) {
                    Button("è¿½åŠ ") {
                        reminderManager.createReminder(title: title, dueDate: dueDate)
                        // sheetã‚’é–‰ã˜ã‚‹
                        dismiss()
                    }
                }
                ToolbarItem(placement: .navigationBarLeading) {
                    Button("ã‚­ãƒ£ãƒ³ã‚»ãƒ«", role: .destructive) {
                        // sheetã‚’é–‰ã˜ã‚‹
                        dismiss()
                    }
                    .buttonStyle(.borderless)
                }
            }
        }
    }
}
```

## 3. CreateReminderViewã‚’ContentViewã‹ã‚‰å‘¼ã³å‡ºã™
ContentViewã®Toolbarã®+ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã€
sheetã§CreateReminderViewã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```diff swift:ContentView.swift
 struct ContentView: View {
     @EnvironmentObject var reminderManager: ReminderManager
+    // sheetã®ãƒ•ãƒ©ã‚°
+    @State var isShowCreateReminderView = false
     
     var body: some View {
         if let aReminder = reminderManager.reminders {
             NavigationStack {
                 List(aReminder, id: \.calendarItemIdentifier) { reminder in
                     HStack {
                         Image(systemName: reminder.isCompleted ? "checkmark.circle.fill" : "circle")
                             .foregroundColor(reminder.isCompleted ? Color.accentColor : Color.gray)
                         Text(reminder.title)
                     }
                 }
+                .sheet(isPresented: $isShowCreateReminderView) {
+                    CreateReminderView()
+                        .presentationDetents([.medium])
+                }
                 .toolbar {
                     ToolbarItem(placement: .principal) {
                         DatePicker("", selection: $reminderManager.day, displayedComponents: .date)
                             .labelsHidden()
                             .onChange(of: reminderManager.day) { newValue in
                                 reminderManager.fetchReminder()
                             }
                     }
+                    ToolbarItem(placement: .navigationBarTrailing) {
+                        Button {
+                            isShowCreateReminderView = true
+                        } label: {
+                            Label("è¿½åŠ ", systemImage: "plus")
+                        }
+                    }
                 }
             }
         } else {
             Text(reminderManager.statusMessage)
         }
     }
 }
```

## 4. å®ŒæˆğŸ‰
![](https://storage.googleapis.com/zenn-user-upload/3aa96d3bdb5f-20221217.png)

:::details ã“ã“ã¾ã§ã®ã‚³ãƒ¼ãƒ‰
```swift:ContentView.swift
import SwiftUI

struct ContentView: View {
    @EnvironmentObject var reminderManager: ReminderManager
    // sheetã®ãƒ•ãƒ©ã‚°
    @State var isShowCreateReminderView = false
    
    var body: some View {
        if let aReminder = reminderManager.reminders {
            NavigationStack {
                List(aReminder, id: \.calendarItemIdentifier) { reminder in
                    HStack {
                        Image(systemName: reminder.isCompleted ? "checkmark.circle.fill" : "circle")
                            .foregroundColor(reminder.isCompleted ? Color.accentColor : Color.gray)
                        Text(reminder.title)
                    }
                }
                .sheet(isPresented: $isShowCreateReminderView) {
                    CreateReminderView()
                        .presentationDetents([.medium])
                }
                .toolbar {
                    ToolbarItem(placement: .principal) {
                        DatePicker("", selection: $reminderManager.day, displayedComponents: .date)
                            .labelsHidden()
                            .onChange(of: reminderManager.day) { newValue in
                                reminderManager.fetchReminder()
                            }
                    }
                    ToolbarItem(placement: .navigationBarTrailing) {
                        Button {
                            isShowCreateReminderView = true
                        } label: {
                            Label("è¿½åŠ ", systemImage: "plus")
                        }
                    }
                }
            }
        } else {
            Text(reminderManager.statusMessage)
        }
    }
}
```

```swift:CreateReminderView.swift
import SwiftUI

struct CreateReminderView: View {
    @EnvironmentObject var reminderManager: ReminderManager
    // ContentViewã®sheetã®ãƒ•ãƒ©ã‚°
    @Environment(\.dismiss) var dismiss
    // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®ã‚¿ã‚¤ãƒˆãƒ«
    @State var title = ""
    // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®é–‹å§‹æ—¥æ™‚
    @State var dueDate = Date()
    
    var body: some View {
        NavigationStack{
            List {
                TextField("ã‚¿ã‚¤ãƒˆãƒ«", text: $title)
                DatePicker("é–‹å§‹", selection: $dueDate)
            }
            .toolbar {
                ToolbarItem(placement: .navigationBarTrailing) {
                    Button("è¿½åŠ ") {
                        reminderManager.createReminder(title: title, dueDate: dueDate)
                        // sheetã‚’é–‰ã˜ã‚‹
                        dismiss()
                    }
                }
                ToolbarItem(placement: .navigationBarLeading) {
                    Button("ã‚­ãƒ£ãƒ³ã‚»ãƒ«", role: .destructive) {
                        // sheetã‚’é–‰ã˜ã‚‹
                        dismiss()
                    }
                    .buttonStyle(.borderless)
                }
            }
        }
    }
}
```

```swift:ReminderManager.swift
import Foundation
import EventKit

class ReminderManager: ObservableObject {
    var store = EKEventStore()
    // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®èªè¨¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    @Published var statusMessage = ""
    // å–å¾—ã•ã‚ŒãŸãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
    @Published var reminders: [EKReminder]? = nil
    // å–å¾—ã—ãŸã„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜
    @Published var day = Date()
    
    init() {
        Task {
            do {
                // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¦æ±‚
                try await store.requestAccess(to: .reminder)
            } catch {
                print(error.localizedDescription)
            }
            // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®èªè¨¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
            let status = EKEventStore.authorizationStatus(for: .reminder)
            
            switch status {
            case .notDetermined:
                statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹\næ¨©é™ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚"
            case .restricted:
                statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹\næ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚"
            case .denied:
                statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒ\næ˜ç¤ºçš„ã«æ‹’å¦ã•ã‚Œã¦ã„ã¾ã™ã€‚"
            case .authorized:
                statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒ\nè¨±å¯ã•ã‚Œã¦ã„ã¾ã™ã€‚"
                fetchReminder()
                // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å¤‰æ›´ã‚’æ¤œå‡ºã—ãŸã‚‰fetchReminder()ã‚’å®Ÿè¡Œã™ã‚‹
                NotificationCenter.default.addObserver(self, selector: #selector(fetchReminder), name: .EKEventStoreChanged, object: store)
            @unknown default:
                statusMessage = "@unknown default"
            }
        }
    }
    
    /// ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®å–å¾—
    @objc func fetchReminder() {
        // é–‹å§‹æ—¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
        // æŒ‡å®šã—ãŸå‰ã®æ—¥ä»˜ã®23:59:59
        let start = Calendar.current.date(byAdding: .second, value: -1, to: Calendar.current.startOfDay(for: day))
        // çµ‚äº†æ—¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
        // æŒ‡å®šã—ãŸæ—¥ä»˜ã®23:59:0
        let end = Calendar.current.date(bySettingHour: 23, minute: 59, second: 0, of: Calendar.current.startOfDay(for: day))
        // ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆã‚¢ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰è¿°èªã‚’ä½œæˆ
        var predicate: NSPredicate? = nil
        predicate = store.predicateForIncompleteReminders(withDueDateStarting: start, ending: end, calendars: nil)
        // è¿°èªã«ä¸€è‡´ã™ã‚‹å…¨ã¦ã®ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’å–å¾—
        if let predicate {
            store.fetchReminders(matching: predicate) { reminder in
                self.reminders = reminder
            }
        }
    }
    
    /// ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®è¿½åŠ 
    func createReminder(title: String, dueDate: Date){
        // æ–°è¦ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®ä½œæˆ
        let reminder = EKReminder(eventStore: store)
        reminder.title = title
        reminder.dueDateComponents = Calendar.current.dateComponents([.calendar, .year, .month, .day, .hour, .minute], from: dueDate)
        // ä¿å­˜ã™ã‚‹ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
        reminder.calendar = store.defaultCalendarForNewReminders()
        do {
            try store.save(reminder, commit: true)
        } catch {
            print(error.localizedDescription)
        }
    }
}
```

```swift:EventKit_ReminderApp.swift
import SwiftUI

@main
struct EventKit_ReminderApp: App {
    var body: some Scene {
        WindowGroup {
            ContentView()
                .environmentObject(ReminderManager())
        }
    }
}
```
:::

# ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’å¤‰æ›´ã™ã‚‹æ‰‹é †
## 1. ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’å¤‰æ›´ã™ã‚‹é–¢æ•°ã‚’ä½œæˆ
https://developer.apple.com/documentation/eventkit/creating_events_and_reminders

å—ã‘å–ã£ãŸãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¨ã‚¿ã‚¤ãƒˆãƒ«ã¨æ—¥æ™‚ã‹ã‚‰ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’å¤‰æ›´ã™ã‚‹é–¢æ•°ã‚’ä½œæˆã—ã¾ã™ã€‚

```swift:ReminderManager.swift
/// ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®å¤‰æ›´
func modifyEvent(reminder: EKReminder,title: String, dueDate: Date){
    // å‰Šé™¤ã—ãŸã„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’å–å¾—
    reminder.title = title
    reminder.dueDateComponents = Calendar.current.dateComponents([.calendar, .year, .month, .day, .hour, .minute], from: dueDate)
    // ä¿å­˜ã™ã‚‹ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
    reminder.calendar = store.defaultCalendarForNewReminders()
    do {
        try store.save(reminder, commit: true)
    } catch {
        print(error.localizedDescription)
    }
}
```

## 2. EventKitã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
```swift:CreateReminderView.swift
import EventKit
```

## 3. CreateReminderViewã‚’å¤‰æ›´ã«ã‚‚å¯¾å¿œã•ã›ã‚‹
CreateReminderViewã§ã‚¤ãƒ™ãƒ³ãƒˆã®è¿½åŠ ã‚‚å¤‰æ›´ã‚‚ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ãã¾ã™ã€‚
CreateReminderViewã‚’å‘¼ã³å‡ºã™éš›ã«å¼•æ•°ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’æŒãŸã›ã¦ã€
ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ãŒæ¸¡ã•ã‚ŒãŸãŸå ´åˆã¯ã€ãã®ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’å¤‰æ›´ã€
nilãŒæ¸¡ã•ã‚ŒãŸå ´åˆã¯è¿½åŠ ã«ãªã‚‹ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

:::message
reminderã‚’@Bindingã§æ¸¡ã—ã¦ã„ã‚‹ã®ã¯sheetã®ä»•æ§˜ã«æº–æ‹ ã™ã‚‹ãŸã‚ã§ã™ã€‚
:::

```diff swift:CreateReminderView.swift
 import SwiftUI
 import EventKit
 
 struct CreateReminderView: View {
     @EnvironmentObject var reminderManager: ReminderManager
     // ContentViewã®sheetã®ãƒ•ãƒ©ã‚°
     @Environment(\.dismiss) var dismiss
+    // å¤‰æ›´ã—ãŸã„ã‚¤ãƒ™ãƒ³ãƒˆ(nilã®å ´åˆã¯æ–°è¦è¿½åŠ )
+    @Binding var reminder: EKReminder?
     // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®ã‚¿ã‚¤ãƒˆãƒ«
     @State var title = ""
     // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®é–‹å§‹æ—¥æ™‚
     @State var dueDate = Date()
     
     var body: some View {
         NavigationStack{
             List {
                 TextField("ã‚¿ã‚¤ãƒˆãƒ«", text: $title)
                 DatePicker("é–‹å§‹", selection: $dueDate)
             }
             .toolbar {
                 ToolbarItem(placement: .navigationBarTrailing) {
-		     Button("è¿½åŠ ") {
+                    Button(reminder == nil ? "è¿½åŠ " : "å¤‰æ›´") {
+                        if let reminder {
+                            reminderManager.modifyEvent(reminder: reminder, title: title, dueDate: dueDate)
+                        } else{
                             reminderManager.createReminder(title: title, dueDate: dueDate)
+                        }
                         // sheetã‚’é–‰ã˜ã‚‹
                         dismiss()
                     }
                 }
                 ToolbarItem(placement: .navigationBarLeading) {
                     Button("ã‚­ãƒ£ãƒ³ã‚»ãƒ«", role: .destructive) {
                         // sheetã‚’é–‰ã˜ã‚‹
                         dismiss()
                     }
                     .buttonStyle(.borderless)
                 }
             }
         }
+        .task {
+            if let reminder {
+                // eventãŒæ¸¡ã•ã‚ŒãŸã‚‰æ—¢å­˜ã®å€¤ã‚’ã‚»ãƒƒãƒˆã™ã‚‹(å¤‰æ›´ã®å ´åˆ)
+                self.title = reminder.title
+                self.dueDate = reminder.dueDateComponents?.date ?? Date()
+            }
+        }
     }
 }
```

## 4. EventKitã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
```swift:ContentView.swift
import EventKit
```

## 5. CreateReminderViewã‚’ContentViewã‹ã‚‰å‘¼ã³å‡ºã™(å¤‰æ›´ã«å¯¾å¿œã•ã›ã‚‹)
ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’ã‚¿ãƒƒãƒ—ã—ãŸã‚‰å¤‰æ›´(CreateReminderView.swiftã«å¤‰æ›´ã—ãŸã„ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¸¡ã—ã¦é–‹ã)
Toolbarã®+ã‚’ã‚¿ãƒƒãƒ—ã—ãŸã‚‰è¿½åŠ (CreateReminderView.swiftã«nilã‚’æ¸¡ã—ã¦é–‹ã)

```diff swift:ContentView.swift
 struct ContentView: View {
     @EnvironmentObject var reminderManager: ReminderManager
     // sheetã®ãƒ•ãƒ©ã‚°
     @State var isShowCreateReminderView = false
+    // å¤‰æ›´ã—ãŸã„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼(è¿½åŠ ã®å ´åˆã¯nil)
+    @State var reminder: EKReminder?
     
     var body: some View {
         if let aReminder = reminderManager.reminders {
             NavigationStack {
                 List(aReminder, id: \.calendarItemIdentifier) { reminder in
                     HStack {
                         Image(systemName: reminder.isCompleted ? "checkmark.circle.fill" : "circle")
                             .foregroundColor(reminder.isCompleted ? Color.accentColor : Color.gray)
-                        Text(reminder.title)
+                        Button(reminder.title) {
+                            // å¤‰æ›´ã—ãŸã„ã‚¤ãƒ™ãƒ³ãƒˆã‚’CreateEventViewã«é€ã‚‹
+                            self.reminder = reminder
+                            isShowCreateReminderView = true
+                        }
                     }
                 }
                 .sheet(isPresented: $isShowCreateReminderView) {
-                    CreateReminderView()
+                    CreateReminderView(reminder: $reminder)
                         .presentationDetents([.medium])
                 }
                 .toolbar {
                     ToolbarItem(placement: .principal) {
                         DatePicker("", selection: $reminderManager.day, displayedComponents: .date)
                             .labelsHidden()
                             .onChange(of: reminderManager.day) { newValue in
                                 reminderManager.fetchReminder()
                             }
                     }
                     ToolbarItem(placement: .navigationBarTrailing) {
                         Button {
+                            // è¿½åŠ ã—ãŸã„å ´åˆã¯ã€CreateReminderViewã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ã‚‰ãªã„(nilã‚’é€ã‚‹)
+                            reminder = nil
                             isShowCreateReminderView = true
                         } label: {
                             Label("è¿½åŠ ", systemImage: "plus")
                         }
                     }
                 }
             }
         } else {
             Text(reminderManager.statusMessage)
         }
     }
 }
```

## 6. å®ŒæˆğŸ‰
![](https://storage.googleapis.com/zenn-user-upload/f544c204d2a5-20221217.png)

:::details ã“ã“ã¾ã§ã®ã‚³ãƒ¼ãƒ‰
```swift:ContentView.swift
import SwiftUI
import EventKit

struct ContentView: View {
    @EnvironmentObject var reminderManager: ReminderManager
    // sheetã®ãƒ•ãƒ©ã‚°
    @State var isShowCreateReminderView = false
    // å¤‰æ›´ã—ãŸã„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼(è¿½åŠ ã®å ´åˆã¯nil)
    @State var reminder: EKReminder?
    
    var body: some View {
        if let aReminder = reminderManager.reminders {
            NavigationStack {
                List(aReminder, id: \.calendarItemIdentifier) { reminder in
                    HStack {
                        Image(systemName: reminder.isCompleted ? "checkmark.circle.fill" : "circle")
                            .foregroundColor(reminder.isCompleted ? Color.accentColor : Color.gray)
                        Button(reminder.title) {
                            // å¤‰æ›´ã—ãŸã„ã‚¤ãƒ™ãƒ³ãƒˆã‚’CreateEventViewã«é€ã‚‹
                            self.reminder = reminder
                            isShowCreateReminderView = true
                        }
                    }
                }
                .sheet(isPresented: $isShowCreateReminderView) {
                    CreateReminderView(reminder: $reminder)
                        .presentationDetents([.medium])
                }
                .toolbar {
                    ToolbarItem(placement: .principal) {
                        DatePicker("", selection: $reminderManager.day, displayedComponents: .date)
                            .labelsHidden()
                            .onChange(of: reminderManager.day) { newValue in
                                reminderManager.fetchReminder()
                            }
                    }
                    ToolbarItem(placement: .navigationBarTrailing) {
                        Button {
                            // è¿½åŠ ã—ãŸã„å ´åˆã¯ã€CreateReminderViewã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ã‚‰ãªã„(nilã‚’é€ã‚‹)
                            reminder = nil
                            isShowCreateReminderView = true
                        } label: {
                            Label("è¿½åŠ ", systemImage: "plus")
                        }
                    }
                }
            }
        } else {
            Text(reminderManager.statusMessage)
        }
    }
}
```
```swift:CreateReminderView.swift
import SwiftUI
import EventKit

struct CreateReminderView: View {
    @EnvironmentObject var reminderManager: ReminderManager
    // ContentViewã®sheetã®ãƒ•ãƒ©ã‚°
    @Environment(\.dismiss) var dismiss
    // å¤‰æ›´ã—ãŸã„ã‚¤ãƒ™ãƒ³ãƒˆ(nilã®å ´åˆã¯æ–°è¦è¿½åŠ )
    @Binding var reminder: EKReminder?
    // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®ã‚¿ã‚¤ãƒˆãƒ«
    @State var title = ""
    // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®é–‹å§‹æ—¥æ™‚
    @State var dueDate = Date()
    
    var body: some View {
        NavigationStack{
            List {
                TextField("ã‚¿ã‚¤ãƒˆãƒ«", text: $title)
                DatePicker("é–‹å§‹", selection: $dueDate)
            }
            .toolbar {
                ToolbarItem(placement: .navigationBarTrailing) {
                    Button(reminder == nil ? "è¿½åŠ " : "å¤‰æ›´") {
                        if let reminder {
                            reminderManager.modifyEvent(reminder: reminder, title: title, dueDate: dueDate)
                        } else{
                            reminderManager.createReminder(title: title, dueDate: dueDate)
                        }
                        // sheetã‚’é–‰ã˜ã‚‹
                        dismiss()
                    }
                }
                ToolbarItem(placement: .navigationBarLeading) {
                    Button("ã‚­ãƒ£ãƒ³ã‚»ãƒ«", role: .destructive) {
                        // sheetã‚’é–‰ã˜ã‚‹
                        dismiss()
                    }
                    .buttonStyle(.borderless)
                }
            }
        }
        .task {
            if let reminder {
                // eventãŒæ¸¡ã•ã‚ŒãŸã‚‰æ—¢å­˜ã®å€¤ã‚’ã‚»ãƒƒãƒˆã™ã‚‹(å¤‰æ›´ã®å ´åˆ)
                self.title = reminder.title
                self.dueDate = reminder.dueDateComponents?.date ?? Date()
            }
        }
    }
}
```
```swift:ReminderManager.swift
import Foundation
import EventKit

class ReminderManager: ObservableObject {
    var store = EKEventStore()
    // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®èªè¨¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    @Published var statusMessage = ""
    // å–å¾—ã•ã‚ŒãŸãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
    @Published var reminders: [EKReminder]? = nil
    // å–å¾—ã—ãŸã„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜
    @Published var day = Date()
    
    init() {
        Task {
            do {
                // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¦æ±‚
                try await store.requestAccess(to: .reminder)
            } catch {
                print(error.localizedDescription)
            }
            // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®èªè¨¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
            let status = EKEventStore.authorizationStatus(for: .reminder)
            
            switch status {
            case .notDetermined:
                statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹\næ¨©é™ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚"
            case .restricted:
                statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹\næ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚"
            case .denied:
                statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒ\næ˜ç¤ºçš„ã«æ‹’å¦ã•ã‚Œã¦ã„ã¾ã™ã€‚"
            case .authorized:
                statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒ\nè¨±å¯ã•ã‚Œã¦ã„ã¾ã™ã€‚"
                fetchReminder()
                // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å¤‰æ›´ã‚’æ¤œå‡ºã—ãŸã‚‰fetchReminder()ã‚’å®Ÿè¡Œã™ã‚‹
                NotificationCenter.default.addObserver(self, selector: #selector(fetchReminder), name: .EKEventStoreChanged, object: store)
            @unknown default:
                statusMessage = "@unknown default"
            }
        }
    }
    
    /// ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®å–å¾—
    @objc func fetchReminder() {
        // é–‹å§‹æ—¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
        // æŒ‡å®šã—ãŸå‰ã®æ—¥ä»˜ã®23:59:59
        let start = Calendar.current.date(byAdding: .second, value: -1, to: Calendar.current.startOfDay(for: day))
        // çµ‚äº†æ—¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
        // æŒ‡å®šã—ãŸæ—¥ä»˜ã®23:59:0
        let end = Calendar.current.date(bySettingHour: 23, minute: 59, second: 0, of: Calendar.current.startOfDay(for: day))
        // ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆã‚¢ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰è¿°èªã‚’ä½œæˆ
        var predicate: NSPredicate? = nil
        predicate = store.predicateForIncompleteReminders(withDueDateStarting: start, ending: end, calendars: nil)
        // è¿°èªã«ä¸€è‡´ã™ã‚‹å…¨ã¦ã®ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’å–å¾—
        if let predicate {
            store.fetchReminders(matching: predicate) { reminder in
                self.reminders = reminder
            }
        }
    }
    
    /// ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®è¿½åŠ 
    func createReminder(title: String, dueDate: Date){
        // æ–°è¦ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®ä½œæˆ
        let reminder = EKReminder(eventStore: store)
        reminder.title = title
        reminder.dueDateComponents = Calendar.current.dateComponents([.calendar, .year, .month, .day, .hour, .minute], from: dueDate)
        // ä¿å­˜ã™ã‚‹ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
        reminder.calendar = store.defaultCalendarForNewReminders()
        do {
            try store.save(reminder, commit: true)
        } catch {
            print(error.localizedDescription)
        }
    }
    
    /// ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®å¤‰æ›´
    func modifyEvent(reminder: EKReminder,title: String, dueDate: Date){
        // å‰Šé™¤ã—ãŸã„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’å–å¾—
        reminder.title = title
        reminder.dueDateComponents = Calendar.current.dateComponents([.calendar, .year, .month, .day, .hour, .minute], from: dueDate)
        // ä¿å­˜ã™ã‚‹ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
        reminder.calendar = store.defaultCalendarForNewReminders()
        do {
            try store.save(reminder, commit: true)
        } catch {
            print(error.localizedDescription)
        }
    }
}
```
```swift:EventKit_ReminderApp.swift
import SwiftUI

@main
struct EventKit_ReminderApp: App {
    var body: some Scene {
        WindowGroup {
            ContentView()
                .environmentObject(ReminderManager())
        }
    }
}
```
:::

# ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’å‰Šé™¤ã™ã‚‹æ‰‹é †
## 1. ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°ã‚’ä½œæˆ
å—ã‘å–ã£ãŸãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°ã‚’ä½œæˆã—ã¾ã™ã€‚

```swift:ReminderManager.swift
/// ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®å‰Šé™¤
func deleteEvent(event: EKReminder){
    // å‰Šé™¤ã—ãŸã„ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—
    do {
        try store.remove(event,commit: true)
    } catch {
        print(error.localizedDescription)
    }
}
```

## 2. ContentViewã‹ã‚‰ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‰Šé™¤ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’é•·æŠ¼ã—ã—ãŸã‚‰å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```diff swift:ContentView.swift
 struct ContentView: View {
     @EnvironmentObject var reminderManager: ReminderManager
     // sheetã®ãƒ•ãƒ©ã‚°
     @State var isShowCreateReminderView = false
     // å¤‰æ›´ã—ãŸã„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼(è¿½åŠ ã®å ´åˆã¯nil)
     @State var reminder: EKReminder?
     
     var body: some View {
         if let aReminder = reminderManager.reminders {
             NavigationStack {
                 List(aReminder, id: \.calendarItemIdentifier) { reminder in
                     HStack {
                         Image(systemName: reminder.isCompleted ? "checkmark.circle.fill" : "circle")
                             .foregroundColor(reminder.isCompleted ? Color.accentColor : Color.gray)
                         Button(reminder.title) {
                             // å¤‰æ›´ã—ãŸã„ã‚¤ãƒ™ãƒ³ãƒˆã‚’CreateEventViewã«é€ã‚‹
                             self.reminder = reminder
                             isShowCreateReminderView = true
                         }
                     }
+                    .contextMenu {
+                        Button(role: .destructive) {
+                            reminderManager.deleteEvent(event: reminder)
+                        } label: {
+                            Label("å‰Šé™¤", systemImage: "trash")
+                        }
+                    }
                 }
                 .sheet(isPresented: $isShowCreateReminderView) {
                     CreateReminderView(reminder: $reminder)
                         .presentationDetents([.medium])
                 }
                 .toolbar {
                     ToolbarItem(placement: .principal) {
                         DatePicker("", selection: $reminderManager.day, displayedComponents: .date)
                             .labelsHidden()
                             .onChange(of: reminderManager.day) { newValue in
                                 reminderManager.fetchReminder()
                             }
                     }
                     ToolbarItem(placement: .navigationBarTrailing) {
                         Button {
                             // è¿½åŠ ã—ãŸã„å ´åˆã¯ã€CreateReminderViewã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ã‚‰ãªã„(nilã‚’é€ã‚‹)
                             reminder = nil
                             isShowCreateReminderView = true
                         } label: {
                             Label("è¿½åŠ ", systemImage: "plus")
                         }
                     }
                 }
             }
         } else {
             Text(reminderManager.statusMessage)
         }
     }
 }
```

## 3. å®ŒæˆğŸ‰
![](https://storage.googleapis.com/zenn-user-upload/578cf1c2cad7-20221217.png)

:::details ã“ã“ã¾ã§ã®ã‚³ãƒ¼ãƒ‰
```swift:ContentView.swift
import SwiftUI
import EventKit

struct ContentView: View {
    @EnvironmentObject var reminderManager: ReminderManager
    // sheetã®ãƒ•ãƒ©ã‚°
    @State var isShowCreateReminderView = false
    // å¤‰æ›´ã—ãŸã„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼(è¿½åŠ ã®å ´åˆã¯nil)
    @State var reminder: EKReminder?
    
    var body: some View {
        if let aReminder = reminderManager.reminders {
            NavigationStack {
                List(aReminder, id: \.calendarItemIdentifier) { reminder in
                    HStack {
                        Image(systemName: reminder.isCompleted ? "checkmark.circle.fill" : "circle")
                            .foregroundColor(reminder.isCompleted ? Color.accentColor : Color.gray)
                        Button(reminder.title) {
                            // å¤‰æ›´ã—ãŸã„ã‚¤ãƒ™ãƒ³ãƒˆã‚’CreateEventViewã«é€ã‚‹
                            self.reminder = reminder
                            isShowCreateReminderView = true
                        }
                    }
                    .contextMenu {
                        Button(role: .destructive) {
                            reminderManager.deleteEvent(event: reminder)
                        } label: {
                            Label("å‰Šé™¤", systemImage: "trash")
                        }
                    }
                }
                .sheet(isPresented: $isShowCreateReminderView) {
                    CreateReminderView(reminder: $reminder)
                        .presentationDetents([.medium])
                }
                .toolbar {
                    ToolbarItem(placement: .principal) {
                        DatePicker("", selection: $reminderManager.day, displayedComponents: .date)
                            .labelsHidden()
                            .onChange(of: reminderManager.day) { newValue in
                                reminderManager.fetchReminder()
                            }
                    }
                    ToolbarItem(placement: .navigationBarTrailing) {
                        Button {
                            // è¿½åŠ ã—ãŸã„å ´åˆã¯ã€CreateReminderViewã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ã‚‰ãªã„(nilã‚’é€ã‚‹)
                            reminder = nil
                            isShowCreateReminderView = true
                        } label: {
                            Label("è¿½åŠ ", systemImage: "plus")
                        }
                    }
                }
            }
        } else {
            Text(reminderManager.statusMessage)
        }
    }
}
```
```swift:CreateReminderView.swift
import SwiftUI
import EventKit

struct CreateReminderView: View {
    @EnvironmentObject var reminderManager: ReminderManager
    // ContentViewã®sheetã®ãƒ•ãƒ©ã‚°
    @Environment(\.dismiss) var dismiss
    // å¤‰æ›´ã—ãŸã„ã‚¤ãƒ™ãƒ³ãƒˆ(nilã®å ´åˆã¯æ–°è¦è¿½åŠ )
    @Binding var reminder: EKReminder?
    // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®ã‚¿ã‚¤ãƒˆãƒ«
    @State var title = ""
    // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®é–‹å§‹æ—¥æ™‚
    @State var dueDate = Date()
    
    var body: some View {
        NavigationStack{
            List {
                TextField("ã‚¿ã‚¤ãƒˆãƒ«", text: $title)
                DatePicker("é–‹å§‹", selection: $dueDate)
            }
            .toolbar {
                ToolbarItem(placement: .navigationBarTrailing) {
                    Button(reminder == nil ? "è¿½åŠ " : "å¤‰æ›´") {
                        if let reminder {
                            reminderManager.modifyEvent(reminder: reminder, title: title, dueDate: dueDate)
                        } else{
                            reminderManager.createReminder(title: title, dueDate: dueDate)
                        }
                        // sheetã‚’é–‰ã˜ã‚‹
                        dismiss()
                    }
                }
                ToolbarItem(placement: .navigationBarLeading) {
                    Button("ã‚­ãƒ£ãƒ³ã‚»ãƒ«", role: .destructive) {
                        // sheetã‚’é–‰ã˜ã‚‹
                        dismiss()
                    }
                    .buttonStyle(.borderless)
                }
            }
        }
        .task {
            if let reminder {
                // eventãŒæ¸¡ã•ã‚ŒãŸã‚‰æ—¢å­˜ã®å€¤ã‚’ã‚»ãƒƒãƒˆã™ã‚‹(å¤‰æ›´ã®å ´åˆ)
                self.title = reminder.title
                self.dueDate = reminder.dueDateComponents?.date ?? Date()
            }
        }
    }
}
```
```swift:ReminderManager.swift
import Foundation
import EventKit

class ReminderManager: ObservableObject {
    var store = EKEventStore()
    // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®èªè¨¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    @Published var statusMessage = ""
    // å–å¾—ã•ã‚ŒãŸãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
    @Published var reminders: [EKReminder]? = nil
    // å–å¾—ã—ãŸã„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜
    @Published var day = Date()
    
    init() {
        Task {
            do {
                // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¦æ±‚
                try await store.requestAccess(to: .reminder)
            } catch {
                print(error.localizedDescription)
            }
            // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®èªè¨¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
            let status = EKEventStore.authorizationStatus(for: .reminder)
            
            switch status {
            case .notDetermined:
                statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹\næ¨©é™ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚"
            case .restricted:
                statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹\næ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚"
            case .denied:
                statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒ\næ˜ç¤ºçš„ã«æ‹’å¦ã•ã‚Œã¦ã„ã¾ã™ã€‚"
            case .authorized:
                statusMessage = "ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒ\nè¨±å¯ã•ã‚Œã¦ã„ã¾ã™ã€‚"
                fetchReminder()
                // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å¤‰æ›´ã‚’æ¤œå‡ºã—ãŸã‚‰fetchReminder()ã‚’å®Ÿè¡Œã™ã‚‹
                NotificationCenter.default.addObserver(self, selector: #selector(fetchReminder), name: .EKEventStoreChanged, object: store)
            @unknown default:
                statusMessage = "@unknown default"
            }
        }
    }
    
    /// ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®å–å¾—
    @objc func fetchReminder() {
        // é–‹å§‹æ—¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
        // æŒ‡å®šã—ãŸå‰ã®æ—¥ä»˜ã®23:59:59
        let start = Calendar.current.date(byAdding: .second, value: -1, to: Calendar.current.startOfDay(for: day))
        // çµ‚äº†æ—¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
        // æŒ‡å®šã—ãŸæ—¥ä»˜ã®23:59:0
        let end = Calendar.current.date(bySettingHour: 23, minute: 59, second: 0, of: Calendar.current.startOfDay(for: day))
        // ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆã‚¢ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰è¿°èªã‚’ä½œæˆ
        var predicate: NSPredicate? = nil
        predicate = store.predicateForIncompleteReminders(withDueDateStarting: start, ending: end, calendars: nil)
        // è¿°èªã«ä¸€è‡´ã™ã‚‹å…¨ã¦ã®ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’å–å¾—
        if let predicate {
            store.fetchReminders(matching: predicate) { reminder in
                self.reminders = reminder
            }
        }
    }
    
    /// ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®è¿½åŠ 
    func createReminder(title: String, dueDate: Date){
        // æ–°è¦ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®ä½œæˆ
        let reminder = EKReminder(eventStore: store)
        reminder.title = title
        reminder.dueDateComponents = Calendar.current.dateComponents([.calendar, .year, .month, .day, .hour, .minute], from: dueDate)
        // ä¿å­˜ã™ã‚‹ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
        reminder.calendar = store.defaultCalendarForNewReminders()
        do {
            try store.save(reminder, commit: true)
        } catch {
            print(error.localizedDescription)
        }
    }
    
    /// ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®å¤‰æ›´
    func modifyEvent(reminder: EKReminder,title: String, dueDate: Date){
        // å‰Šé™¤ã—ãŸã„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’å–å¾—
        reminder.title = title
        reminder.dueDateComponents = Calendar.current.dateComponents([.calendar, .year, .month, .day, .hour, .minute], from: dueDate)
        // ä¿å­˜ã™ã‚‹ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
        reminder.calendar = store.defaultCalendarForNewReminders()
        do {
            try store.save(reminder, commit: true)
        } catch {
            print(error.localizedDescription)
        }
    }
    
    /// ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®å‰Šé™¤
    func deleteEvent(event: EKReminder){
        // å‰Šé™¤ã—ãŸã„ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—
        do {
            try store.remove(event,commit: true)
        } catch {
            print(error.localizedDescription)
        }
    }
}
```
```swift:EventKit_ReminderApp.swift
import SwiftUI

@main
struct EventKit_ReminderApp: App {
    var body: some Scene {
        WindowGroup {
            ContentView()
                .environmentObject(ReminderManager())
        }
    }
}
```

:::

# EventKitã‚’ä½¿ç”¨ã—ãŸã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª
ã“ã®è¨˜äº‹ã§ç´¹ä»‹ã—ãŸã€
1. ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®å–å¾—
2. ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®è¿½åŠ 
3. ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®å¤‰æ›´
4. ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®å‰Šé™¤
ä¸Šè¨˜ã®æ©Ÿèƒ½çµ„ã¿åˆã‚ã›ãŸã‚µãƒ³ãƒ—ãƒ«ã‚’GitHubã«å…¬é–‹ã—ã¾ã—ãŸã€‚
https://github.com/kame-08/EventKit-Reminder